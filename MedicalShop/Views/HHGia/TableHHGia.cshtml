@model IEnumerable<MedicalShop.Models.Entities.ChiNhanh>
@{
    Layout = "~/Views/Shared/_LayoutNV.cshtml";

    MedicalShopContext context = new MedicalShopContext();
    int idCN = int.Parse(User.Claims.ElementAt(4).Value);
    string admin = User.Claims.ElementAt(3).ValueType;

    List<HangHoa> listHH()
    {
        return context.HangHoa
        .Where(x => x.Active == true) //&& x.Idcn == idCN
        .OrderBy(x => x.TenHh).ToList();
    }



    HhGia getGia(int? id, int? IdChiNhanh)
    {
        HhGia giahh = context.HhGia.FirstOrDefault(x => x.Idhh == id && x.Idcn == IdChiNhanh);
        if (giahh != null) return giahh;
        else return new HhGia();
    }


}

<link href="~/admin/css/switch.css" rel="stylesheet" />

<style>

    .wh-input input {
        width: 17px;
        height: 17px;
    }

    .color-clicked {
        background-color: #f5f8fe;
        font-weight: bold;
        color: #0d6efd;
    }
</style>


<div class="card mb-0" style=" margin-bottom: 4rem !important ">
    <div class="h-75" style="overflow-x:auto; margin-bottom: 1rem;">
        <div class="mt-3 mb-1 col-lg-7 col-md-7 d-flex align-items-start justify-content-between">
            @*mc-13*@
            <div class="switch col-6">
                <div class="switch__1">
                    <input id="switch-1" type="checkbox">
                    <label for="switch-1" title="Lọc giá lỗi thời"></label>
                </div>
            </div>
            <div class="group-btn col-6">
                <div class="d-flex justify-content-end">
                    <button class="btn btn-primary" style="border-radius:unset ; width: 5rem ;" type="button" id="btn-save">
                        <span>Lưu</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="row p-1 mb-1 ms-0 col-lg-7 col-md-7">
            <select required name="cbChiNhanhHHLT" id="cbChiNhanhHHLT" class="custom-select" @(Model.Count() == 1 ? "disabled" : "")>
                @foreach (var itemm in Model)
                {
                    <option value="@itemm.Id" selected="@(itemm.Id == idCN)">@itemm.TenCn</option>
                }
               @* @if (admin == "1")
                {
                    <option value="-1" >Tất cả</option>
                }*@
            </select>
        </div>
        @*flex-direction: row; flex-wrap: wrap; overflow-x: auto; align-items: flex-start; justify-content: space-between;*@
        <div class="row col-md-12 d-flex align-items-start" style="">
            <div id="table1" class="col-md-7 table-responsive" style="height: 23rem">
                <table class="table table-striped" id="table2" >
                    <thead style="position: sticky; top: 0; ">
                        <tr style="background: #e9ecef;">
                            @*<th style="width:15px">STT</th>*@
                            <th class="text-center">Danh sách hàng hóa</th>
                            <th>Tỉ lệ (%)</th>
                            <th>Giá</th>
                        </tr>
                    </thead>
                    <tbody id="giaban">
                        @foreach (HangHoa hh in listHH())
                        {
                            <tr onclick="loadDSNhap(@hh.Id)">
                                @*<td id="stt"></td>*@
                                <td class="text-left" style="width:20rem;">
                                    <span>@hh.TenHh</span>
                                    <input type="hidden" value="@hh.Id" class="idvt" />
                                </td>
                                <td style="width:6rem;">
                                    <input type="text" class="form-control tile text-right formatted-number-float" value="@getGia(@hh.Id, idCN).TiLe">
                                </td>
                                <td style="width:6rem;">
                                    <input style=" min-width: max-content;" type="text" class="form-control gia text-right formatted-number-float" value="@getGia(@hh.Id, idCN).Price" />
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            @*<input type="hidden" id="idvt" />*@
            <div class="col-md-5 border-dark table-responsive" style="height: 23rem">
                <table class="table table-striped d-none" style="white-space: nowrap;" id="table3">
                    <thead style="position: sticky; top: 0; ">
                        <tr style="background: #e9ecef;">
                            @*<th class="text-center" style="vertical-align : middle;text-align:center;">STT</th>*@
                            <th class="text-center">Ngày nhập</th>
                            <th class="text-center">HSD</th>
                            <th class="text-center">Đang tồn</th>
                            <th class="text-center">Giá nhập</th>
                        </tr>
                    </thead>
                    <tbody id="gianhap">
                        <tr>
                            <td>..</td>
                            <td>..</td>
                            <td>..</td>
                            <td>..</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="~/admin/js/switch.js"></script>

<script src="~/admin/customjs/hanghoagia.js" asp-append-version="true"></script>

<script>
    _idCN = @idCN;
</script>