@model MedicalShop.Models.Entities.Dvt

@{
  Layout = "~/Views/Shared/_LayoutNV.cshtml";
  MedicalShopContext context = new MedicalShopContext();


  List<Dvt> listDVT()
  {
    return context.Dvt.Where(a => a.Active == true).ToList();
  }

  NhanVien getNV(int? id)
  {
    NhanVien nv = context.NhanVien.FirstOrDefault(x => x.Id == id);
    if (nv != null) return nv;
    else return new NhanVien();
  }

  ChiNhanh getCN(int? id)
  {
    ChiNhanh cn = context.ChiNhanh.Find(id);
    if (cn != null) return cn;
    else return new ChiNhanh();
  }

}

@if (TempData["ThongBao"] != null)
{
  <script type="text/javascript" charset="utf-8">
                        window.onload = function () {
                            alert("@Html.Raw(@TempData["ThongBao"])");
                    };
  </script>
}


<div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
  <div style="margin-bottom: 20px">
    <a href="/DVT/ViewCreate" class="btn btn-secondary"><span>Thêm mới</span></a>
    </div>
    <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
      <div style="display: flex">
        <div class="dropdown" style="margin-right:10px">
          <select id="active" onchange="changeHH()" class="custom-select">
            <option value="true" selected>Hiện tại</option>
            <option value="false">Tất cả</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div id="tableDVT" style="overflow-x: auto; overflow-y: hidden; width: 100%;">
    <table class="table">
      <thead>
        <tr>
          <th>
            @Html.DisplayNameFor(model => model.MaDvt)
          </th>
          <th>
            @Html.DisplayNameFor(model => model.TenDvt)
          </th>
          <th>
            @Html.DisplayNameFor(model => model.CreatedDate)
          </th>
          <th>
            @Html.DisplayNameFor(model => model.CreatedBy)
          </th>
          <th>
            @Html.DisplayNameFor(model => model.ModifiedDate)
          </th>
          <th>
            @Html.DisplayNameFor(model => model.ModifiedBy)
          </th>
          <th>
            @Html.DisplayNameFor(model => model.Idcn)
          </th>
          <th>Tùy chọn</th>
        </tr>
      </thead>
      <tbody>
        @foreach (Dvt item in listDVT())
        {
          <tr>
            <td>
              @Html.DisplayFor(modelItem => item.MaDvt)
            </td>
            <td>
              @Html.DisplayFor(modelItem => item.TenDvt)
            </td>
            <td>
              @Html.DisplayFor(modelItem => item.CreatedDate)
            </td>
            <td>
              @getNV(item.CreatedBy).TenNv
            </td>
            <td>
              @Html.DisplayFor(modelItem => item.ModifiedDate)
            </td>
            <td>
              @getNV(item.ModifiedBy).TenNv
            </td>
            <td>
              @getCN(item.Idcn).TenCn
            </td>
            <td>
              @Html.ActionLink(" ", "ViewUpdate", new { id = item.Id }, new { @class = "far fa-edit lighter" })|
              @Html.ActionLink(" ", "Delete", new { id = item.Id }, new { @class = "fas fa-trash-alt lighter", onclick = "return confirm('Bạn muốn xoá đối tượng này?')" })
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>


  <script>
    $('#active').on('change', function () {
      var a = $(this).val();
      $.ajax({
        type: "post",
        url: "/loadTableDVT",
        data: "active=" + a,
        success: function (result) {
          $('#tableDVT').replaceWith(result);
        },
        error: function () {
          alert("Failed");
        }
      });
    });
  </script>
